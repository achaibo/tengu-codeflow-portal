<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Global Patient Advocacy Atlas — NSCLC (Iovance focus)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!-- Tailwind CSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Chart.js CDN -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    .chip { font-size:.75rem; padding:.2rem .5rem; border-radius:9999px; border:1px solid rgba(0,0,0,.06) }
    .card { background:#fff; border:1px solid #e5e7eb; border-radius:0.75rem; box-shadow:0 4px 10px rgba(0,0,0,.04) }
    .shade { background:linear-gradient(180deg, rgba(99,102,241,.08), transparent) }
    .chip-toggle { cursor:pointer; user-select:none }
    .chip-active { outline:2px solid #4f46e5; box-shadow:0 0 0 2px #c7d2fe inset }
    @media print { .no-print { display:none } .tab-pane{ display:block !important } }
  </style>
</head>
<body class="bg-slate-50 text-slate-800 font-sans">
  <!-- HERO -->
  <header class="shade">
    <div class="mx-auto max-w-7xl px-4 py-8 md:py-12">
      <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-6">
        <div class="max-w-3xl">
          <h1 class="text-3xl md:text-5xl font-extrabold text-indigo-700 leading-tight">
            Global Patient Advocacy Atlas — NSCLC
          </h1>
          <p class="mt-3 text-lg md:text-xl text-slate-700">
            A color‑coded, interview‑ready map of how <span class="font-semibold">non‑small cell lung cancer</span> (NSCLC) advocacy and trial engagement work across regions—regulators, ethics paths, driver‑mutation communities, cultural nuances, and fast actions for BD & clinical teams.
          </p>
          <p class="mt-2 text-sm text-slate-500">Focus: Iovance Biotherapeutics’ solid tumor programs & patient‑centric partnerships.†</p>
        </div>
        <!-- Decorative mini world banner (inline SVG) -->
        <svg width="260" height="120" viewBox="0 0 520 240" class="mx-auto" role="img" aria-label="Regions at a glance">
          <defs>
            <linearGradient id="g" x1="0" y1="0" x2="1" y2="1">
              <stop offset="0%" stop-color="#6366f1"/><stop offset="100%" stop-color="#22c55e"/>
            </linearGradient>
          </defs>
          <circle cx="120" cy="120" r="100" fill="url(#g)" opacity=".2"/>
          <circle cx="260" cy="120" r="100" fill="url(#g)" opacity=".25"/>
          <circle cx="400" cy="120" r="100" fill="url(#g)" opacity=".2"/>
          <text x="260" y="130" text-anchor="middle" fill="#4f46e5" font-size="22" font-weight="700">Regions at a Glance</text>
        </svg>
      </div>
    </div>
  </header>

  <!-- HOW TO USE -->
  <section class="mx-auto max-w-7xl px-4 pb-4 md:pb-8">
    <div class="card p-6 md:p-8">
      <h2 class="text-2xl font-bold text-indigo-700 mb-3">Using This Atlas</h2>
      <ol class="list-decimal pl-6 mt-3 text-slate-700 space-y-1">
        <li><span class="font-semibold">Switch regions</span> with the tabs. Cards summarize regulators, ethics routes, key lung cancer orgs, and one tactical insight.</li>
        <li><span class="font-semibold">Filter by biomarkers</span> (EGFR, ALK, ROS1, KRAS G12C, METex14, RET, NTRK, HER2, PD‑L1) to tailor outreach to driver‑specific communities.</li>
        <li><span class="font-semibold">Read the chart</span> as the average barrier mix for visible cards. Filters update the chart in real time.</li>
      </ol>
      <p class="mt-3 text-xs text-slate-500">†This atlas is a planning aide for advocacy & operations. Verify local requirements and current trial availability before external use.</p>
    </div>
  </section>

  <!-- BIOMARKER FILTERS -->
  <section class="no-print sticky top-0 z-40 bg-white/90 backdrop-blur border-y border-slate-200">
    <div class="mx-auto max-w-7xl px-4 py-3">
      <div class="flex flex-wrap gap-2 items-center" id="biomarkerBar" aria-label="Biomarker filters">
        <span class="text-xs uppercase tracking-wider text-slate-500">Filter:</span>
        <!-- chips injected by JS -->
      </div>
    </div>
  </section>

  <!-- TABS -->
  <nav class="no-print bg-white border-b border-slate-200">
    <div class="mx-auto max-w-7xl px-4">
      <div class="flex flex-wrap gap-2 py-3" id="tabs" role="tablist" aria-label="Regions">
        <!-- Buttons injected by JS -->
      </div>
    </div>
  </nav>

  <!-- PANES -->
  <main class="mx-auto max-w-7xl px-4 py-8" id="panes">
    <!-- Panes injected by JS -->
  </main>

  <footer class="mx-auto max-w-7xl px-4 pb-16">
    <div class="text-xs text-slate-500">
      Legend: <span class="chip" style="background:#eef2ff">Americas</span>
      <span class="chip" style="background:#ecfeff">Europe</span>
      <span class="chip" style="background:#fff7ed">UK/CH/Turkey</span>
      <span class="chip" style="background:#f0fdf4">Africa</span>
      <span class="chip" style="background:#f5f3ff">APAC</span>
    </div>
  </footer>

  <script>
    // ------------- Regions & Palette ---------------
    const REGIONS = [
      { id: 'americas', label: 'Americas', color: '#6366f1', bg: '#eef2ff' },
      { id: 'europe', label: 'Europe (EU West & East)', color: '#06b6d4', bg: '#ecfeff' },
      { id: 'ukchtur', label: 'UK / Switzerland / Turkey', color: '#f59e0b', bg: '#fff7ed' },
      { id: 'africa', label: 'Africa', color: '#22c55e', bg: '#f0fdf4' },
      { id: 'apac', label: 'APAC', color: '#8b5cf6', bg: '#f5f3ff' },
    ];

    // ------------- Biomarkers ---------------
    const BIOMARKERS = [
      'EGFR','ALK','ROS1','KRAS G12C','METex14','RET','NTRK','HER2','PD-L1'
    ];

    const activeFilters = new Set();

    // ------------- Dataset ---------------
    // Each country: {region, name, regulator, ethics, orgs[], nuances, interview, barrierMix{logistics,regulatory,culture,language}, biomarkers[]}
    const DATA = [
      // AMERICAS
      { region:'americas', name:'United States',
        regulator:'FDA (CBER) — cell & gene; CDER for small molecules',
        ethics:'Central & local IRBs; community sites may retain local review.',
        orgs:['IASLC (global)','GO2 for Lung Cancer','LUNGevity','ALK Positive','EGFR Resisters','ROS1ders','KRAS Kickers','MET Crusaders'],
        nuances:'High screening/biomarker access variability by payer; Spanish‑first microsites; address smoking stigma; ensure reimbursement clarity for tissue vs liquid biopsy; travel & childcare matter.',
        interview:'“I co‑activate GO2/LUNGevity with ALK Positive & EGFR Resisters, then solve logistics (travel, childcare) and bilingual consent to unlock retention.”',
        barrierMix:{logistics:30, regulatory:20, culture:30, language:20},
        biomarkers:['EGFR','ALK','ROS1','KRAS G12C','METex14','RET','NTRK','HER2','PD-L1']
      },
      { region:'americas', name:'Canada',
        regulator:'Health Canada (HPFB/BRDD)',
        ethics:'Institutional REBs; provincial coordination for multi‑site studies.',
        orgs:['Lung Cancer Canada','Canadian Cancer Society','ALK Positive Canada','EGFR Resisters (global)'],
        nuances:'Bilingual EN/FR materials; re‑biopsy logistics across vast geographies; engage Indigenous communities via trusted navigators.',
        interview:'“Canada = bilingual toolkits + provincial REB roadmap + Indigenous navigator partnerships.”',
        barrierMix:{logistics:35, regulatory:20, culture:25, language:20},
        biomarkers:['EGFR','ALK','ROS1','KRAS G12C','METex14','RET','PD-L1']
      },
      { region:'americas', name:'Brazil',
        regulator:'ANVISA',
        ethics:'CONEP/CEPs (national + local ECs); timelines vary.',
        orgs:['Instituto Oncoguia','SBOC (oncology society)','Driver communities (EGFR/ALK/ROS1) via WhatsApp'],
        nuances:'Public (SUS) vs private access gap; WhatsApp education; travel stipends; biomarker testing availability heterogenous.',
        interview:'“Brazil runs on WhatsApp + family leaders—pair travel vouchers with biopsy/NGS navigation.”',
        barrierMix:{logistics:45, regulatory:25, culture:20, language:10},
        biomarkers:['EGFR','ALK','KRAS G12C','PD-L1']
      },
      { region:'americas', name:'Mexico',
        regulator:'COFEPRIS',
        ethics:'Local Research Ethics Committees + national bioethics oversight.',
        orgs:['AMLCC (national cancer)','Fundación IMSS (hospital)','Local driver‑mutation groups'],
        nuances:'Spanish‑first hotlines; leverage faith & community networks; financial toxicity is a primary barrier.',
        interview:'“Mexico = Spanish microsite + WhatsApp hotline + clinic/faith leader briefings.”',
        barrierMix:{logistics:40, regulatory:20, culture:30, language:10},
        biomarkers:['EGFR','ALK','PD-L1']
      },
      { region:'americas', name:'Argentina',
        regulator:'ANMAT',
        ethics:'Institutional ECs; dual approvals (regulatory + ethics).',
        orgs:['LALCEC','FUCA','Hospital‑anchored navigator programs'],
        nuances:'Urban‑centric sites; emphasize lodging support; clear path to NGS reimbursement.',
        interview:'“Argentina needs upfront lodging + biopsy/NGS pathway clarity.”',
        barrierMix:{logistics:40, regulatory:25, culture:25, language:10},
        biomarkers:['EGFR','ALK','KRAS G12C','PD-L1']
      },

      // EUROPE (EUCTR umbrella with national specifics)
      { region:'europe', name:'Germany (EU West)',
        regulator:'BfArM / PEI under EUCTR',
        ethics:'State Ethics Committees (Ethik‑Kommissionen).',
        orgs:['nNGM (genomic medicine network)','Deutsche Krebshilfe','Long Cancer patient groups (DE)'],
        nuances:'Highly structured; German‑language materials; align early with nNGM for testing pathways.',
        interview:'“In Germany I pair nNGM with site navigators and precise German explainers.”',
        barrierMix:{logistics:20, regulatory:35, culture:30, language:15},
        biomarkers:['EGFR','ALK','ROS1','KRAS G12C','METex14','RET','NTRK','HER2','PD-L1']
      },
      { region:'europe', name:'France (EU West)',
        regulator:'ANSM under EUCTR',
        ethics:'CPP (Comités de Protection des Personnes).',
        orgs:['La Ligue Contre le Cancer','Patients en réseau – Cancer du Poumon','WALCE (EU)'],
        nuances:'Partner with national networks; French‑first materials; emphasize public‑good narrative for trials.',
        interview:'“France responds to national networks + transparent science storytelling.”',
        barrierMix:{logistics:20, regulatory:30, culture:35, language:15},
        biomarkers:['EGFR','ALK','KRAS G12C','RET','PD-L1']
      },
      { region:'europe', name:'Netherlands (EU West)',
        regulator:'CCMO under EUCTR',
        ethics:'METCs (local ethics committees).',
        orgs:['Longkanker Nederland','DCRF (research federation)'],
        nuances:'Parent‑scholar culture of patient groups; clear open‑label extension messaging improves retention.',
        interview:'“NL = co‑design with Longkanker Nederland + EHR‑based navigator outreach.”',
        barrierMix:{logistics:20, regulatory:30, culture:30, language:20},
        biomarkers:['EGFR','ALK','ROS1','KRAS G12C','PD-L1']
      },
      { region:'europe', name:'Spain (EU West)',
        regulator:'AEMPS under EUCTR',
        ethics:'CEIm (regional ethics).',
        orgs:['AEACaP (lung cancer assoc.)','SEOM (oncology society)'],
        nuances:'Spanish‑first; regional differences; family and clinician champions drive enrollment.',
        interview:'“Spain needs CEIm‑ready Spanish kits + clinician advocates in each region.”',
        barrierMix:{logistics:25, regulatory:30, culture:30, language:15},
        biomarkers:['EGFR','ALK','KRAS G12C','PD-L1']
      },
      { region:'europe', name:'Italy (EU West)',
        regulator:'AIFA under EUCTR',
        ethics:'Comitati Etici (regional).',
        orgs:['WALCE (Women Against Lung Cancer in Europe)','Alcase Italia'],
        nuances:'Leverage WALCE; emphasize caregiver support and clear imaging/visit cadence.',
        interview:'“Italy responds to WALCE partnership + caregiver relief logistics.”',
        barrierMix:{logistics:25, regulatory:30, culture:30, language:15},
        biomarkers:['EGFR','ALK','ROS1','KRAS G12C','PD-L1']
      },
      { region:'europe', name:'Poland (EU East)',
        regulator:'URPL under EUCTR',
        ethics:'Local Bioethics Committees.',
        orgs:['Stowarzyszenie Walki z Rakiem Płuca','ECPC network'],
        nuances:'Local‑language webinars; regional clinic days; clarity on testing access outside capitals.',
        interview:'“Poland responds to Polish‑first explainers + regional clinic days.”',
        barrierMix:{logistics:30, regulatory:30, culture:25, language:15},
        biomarkers:['EGFR','ALK','KRAS G12C','PD-L1']
      },
      { region:'europe', name:'Czech Republic (EU East)',
        regulator:'SÚKL under EUCTR',
        ethics:'Institutional Ethics Committees.',
        orgs:['National patient alliances via ECPC/EURORDIS','Hospital navigator programs'],
        nuances:'Parent‑peer voices and transparent milestones improve adherence.',
        interview:'“Czech sites: peer mentor calls + clear scan schedules.”',
        barrierMix:{logistics:30, regulatory:25, culture:30, language:15},
        biomarkers:['EGFR','ALK','PD-L1']
      },
      { region:'europe', name:'Hungary (EU East)',
        regulator:'NIPN (OGYÉI) under EUCTR',
        ethics:'Institutional ECs.',
        orgs:['Hungarian Cancer League','Regional hospital trusts'],
        nuances:'Physician‑led outreach; Hungarian‑first materials; travel support outside Budapest.',
        interview:'“Hungary = physician‑anchored sessions + travel vouchers.”',
        barrierMix:{logistics:30, regulatory:30, culture:25, language:15},
        biomarkers:['EGFR','ALK','PD-L1']
      },

      // UK / CH / TURKEY
      { region:'ukchtur', name:'United Kingdom',
        regulator:'MHRA',
        ethics:'HRA/REC (centralized).',
        orgs:['Roy Castle Lung Cancer Foundation','EGFR Positive UK','ALK Positive UK'],
        nuances:'NHS integration enables national roll‑outs; tailor for South Asian & Afro‑Caribbean communities.',
        interview:'“UK = NHS Trusts + Roy Castle + culturally tailored comms for London/Birmingham.”',
        barrierMix:{logistics:25, regulatory:30, culture:30, language:15},
        biomarkers:['EGFR','ALK','ROS1','KRAS G12C','RET','PD-L1']
      },
      { region:'ukchtur', name:'Switzerland',
        regulator:'Swissmedic',
        ethics:'Cantonal Ethics Committees.',
        orgs:['Lungenliga Schweiz (Swiss Lung League)','Hospital navigator programs'],
        nuances:'Multilingual (DE/FR/IT) materials; high‑quality sites; emphasize seamless testing workflow.',
        interview:'“Switzerland needs multilingual packs and navigator co‑signs.”',
        barrierMix:{logistics:20, regulatory:35, culture:30, language:15},
        biomarkers:['EGFR','ALK','ROS1','KRAS G12C','PD-L1']
      },
      { region:'ukchtur', name:'Turkey',
        regulator:'TITCK',
        ethics:'Local hospital/university ECs.',
        orgs:['Turkish Thoracic Society','Local lung cancer associations'],
        nuances:'Hospital‑anchored advocacy; travel to Ankara/Istanbul; family decision‑making norms.',
        interview:'“Turkey = neurologist/oncologist champions + travel support keep families enrolled.”',
        barrierMix:{logistics:40, regulatory:30, culture:20, language:10},
        biomarkers:['EGFR','ALK','PD-L1']
      },

      // AFRICA
      { region:'africa', name:'South Africa',
        regulator:'SAHPRA',
        ethics:'Institutional HRECs (e.g., Wits, UCT).',
        orgs:['Lung Cancer Foundation South Africa','CANSA'],
        nuances:'Urban hubs; equity lens; transport vouchers + CHW partnerships; smoking stigma prominent.',
        interview:'“South Africa = city clinics + CHWs + transport vouchers to overcome stigma & cost.”',
        barrierMix:{logistics:45, regulatory:25, culture:20, language:10},
        biomarkers:['EGFR','ALK','KRAS G12C','PD-L1']
      },

      // APAC
      { region:'apac', name:'China',
        regulator:'NMPA',
        ethics:'Hospital IRBs; strong local governance.',
        orgs:['China Anti‑Cancer Association (lung programs)','Driver communities via WeChat'],
        nuances:'Family‑centered decisions; high EGFR prevalence; WeChat groups + physician champions dominate.',
        interview:'“China runs on WeChat + physician trust—EGFR outreach first, then broader drivers.”',
        barrierMix:{logistics:30, regulatory:35, culture:25, language:10},
        biomarkers:['EGFR','ALK','ROS1','METex14','RET','PD-L1']
      },
      { region:'apac', name:'Japan',
        regulator:'PMDA',
        ethics:'Institutional IRBs.',
        orgs:['Japan Lung Cancer Society','CancerNet Japan (patient info)'],
        nuances:'High precision‑medicine literacy; meticulous transparency; retention strong once trust is earned.',
        interview:'“Japan rewards precision & patience—set expectations early and deliver consistently.”',
        barrierMix:{logistics:20, regulatory:35, culture:35, language:10},
        biomarkers:['EGFR','ALK','ROS1','RET','PD-L1']
      },
      { region:'apac', name:'South Korea',
        regulator:'MFDS',
        ethics:'Institutional IRBs.',
        orgs:['Korean Lung Cancer Association','Hospital navigator programs'],
        nuances:'Physician‑led decisions; urban efficiency; concise, clinical materials win.',
        interview:'“Korea = physician‑first engagement with crisp, clinical materials.”',
        barrierMix:{logistics:20, regulatory:30, culture:35, language:15},
        biomarkers:['EGFR','ALK','ROS1','PD-L1']
      },
      { region:'apac', name:'Taiwan',
        regulator:'TFDA',
        ethics:'Institutional IRBs.',
        orgs:['Taiwan Lung Cancer Society','TFRD links for navigation'],
        nuances:'Physician‑centered; small but responsive driver communities; Mandarin‑first materials.',
        interview:'“Taiwan = treating oncologist + small, fast‑moving patient groups.”',
        barrierMix:{logistics:20, regulatory:30, culture:30, language:20},
        biomarkers:['EGFR','ALK','ROS1','PD-L1']
      },
      { region:'apac', name:'Singapore',
        regulator:'HSA',
        ethics:'DSRBs via hospital clusters.',
        orgs:['Singapore Cancer Society','Hospital cluster navigator teams'],
        nuances:'Hub model; hospital‑anchored advocacy; small population → high‑touch.',
        interview:'“Singapore favors precision advocacy via hospital clusters; align on testing workflow.”',
        barrierMix:{logistics:15, regulatory:35, culture:35, language:15},
        biomarkers:['EGFR','ALK','ROS1','PD-L1']
      },
      { region:'apac', name:'Australia',
        regulator:'TGA',
        ethics:'HRECs (centralized), site governance.',
        orgs:['Lung Foundation Australia','Cancer Council'],
        nuances:'Trial‑friendly; strong navigator networks; telehealth for distance follow‑ups.',
        interview:'“Australia is streamlined—navigator‑led outreach + telehealth retention.”',
        barrierMix:{logistics:25, regulatory:25, culture:35, language:15},
        biomarkers:['EGFR','ALK','ROS1','KRAS G12C','RET','PD-L1']
      },
      { region:'apac', name:'New Zealand',
        regulator:'Medsafe',
        ethics:'HDECs (Health & Disability Ethics Committees).',
        orgs:['Lung Foundation New Zealand','Māori health organizations'],
        nuances:'Respect Kaupapa Māori; small but committed networks; travel support essential.',
        interview:'“NZ = partner with Māori orgs + mobile navigation.”',
        barrierMix:{logistics:30, regulatory:25, culture:35, language:10},
        biomarkers:['EGFR','ALK','KRAS G12C','PD-L1']
      },
      { region:'apac', name:'India',
        regulator:'CDSCO',
        ethics:'Institutional Ethics Committees (IECs).',
        orgs:['Lung Care Foundation','Indian Cancer Society','Driver groups (EGFR/ALK)'],
        nuances:'Multilingual landscape; WhatsApp + local languages; travel and out‑of‑pocket costs are major barriers.',
        interview:'“India needs state‑level, multilingual advocacy + stipends for travel and lost wages.”',
        barrierMix:{logistics:45, regulatory:25, culture:20, language:10},
        biomarkers:['EGFR','ALK','ROS1','PD-L1']
      },
      { region:'apac', name:'Malaysia',
        regulator:'NPRA',
        ethics:'MREC (MOH) + institutional RECs.',
        orgs:['National Cancer Society Malaysia','Hospital‑based patient groups'],
        nuances:'Trilingual materials (BM/EN/ZH); hospital‑led outreach works; emphasize biomarker access pathways.',
        interview:'“Malaysia = hospital‑first + trilingual explainers + NGS navigation.”',
        barrierMix:{logistics:30, regulatory:25, culture:30, language:15},
        biomarkers:['EGFR','ALK','PD-L1']
      },
      { region:'apac', name:'Philippines',
        regulator:'FDA Philippines',
        ethics:'Institutional IRBs; SJREB for DOH hospitals.',
        orgs:['Philippine Lung Center networks','PSMO (oncology society)'],
        nuances:'Faith/community leaders as gatekeepers; text/WhatsApp primary channels; transport & lost‑wage stipends crucial.',
        interview:'“Philippines = faith/community leader partnerships + stipend clarity.”',
        barrierMix:{logistics:40, regulatory:25, culture:25, language:10},
        biomarkers:['EGFR','ALK','PD-L1']
      },
    ];

    // ---------- DOM references ----------
    const tabsEl = document.getElementById('tabs');
    const panesEl = document.getElementById('panes');
    const biomarkerBar = document.getElementById('biomarkerBar');

    // ---------- Build biomarker chips ----------
    BIOMARKERS.forEach(bm => {
      const s = document.createElement('span');
      s.className = 'chip chip-toggle';
      s.textContent = bm;
      s.setAttribute('role','button');
      s.setAttribute('tabindex','0');
      s.addEventListener('click', ()=>toggleFilter(s, bm));
      s.addEventListener('keypress', (e)=>{ if(e.key==='Enter' || e.key===' '){ e.preventDefault(); toggleFilter(s, bm);} });
      biomarkerBar.appendChild(s);
    });

    function toggleFilter(el, bm){
      if(activeFilters.has(bm)){
        activeFilters.delete(bm);
        el.classList.remove('chip-active');
      } else {
        activeFilters.add(bm);
        el.classList.add('chip-active');
      }
      renderAll();
    }

    // ---------- Utilities ----------
    function visibleItems(regionId){
      const items = DATA.filter(d => d.region === regionId);
      if(activeFilters.size === 0) return items;
      return items.filter(d => d.biomarkers?.some(b => activeFilters.has(b)));
    }

    function aggregateMix(items){
      const base = { logistics:0, regulatory:0, culture:0, language:0 };
      if (!items.length) return base;
      items.forEach(d => {
        base.logistics += d.barrierMix.logistics;
        base.regulatory += d.barrierMix.regulatory;
        base.culture   += d.barrierMix.culture;
        base.language  += d.barrierMix.language;
      });
      Object.keys(base).forEach(k => base[k] = Math.round(base[k]/items.length));
      return base;
    }

    // ---------- Render tabs ----------
    REGIONS.forEach((r, i) => {
      const b = document.createElement('button');
      b.textContent = r.label;
      b.className = 'px-4 py-2 rounded-full border border-slate-200 text-sm font-semibold transition-colors duration-200';
      b.dataset.tab = r.id;
      b.setAttribute('role','tab');
      if (i === 0) { b.style.backgroundColor = r.color; b.style.color = '#fff'; }
      tabsEl.appendChild(b);
    });

    // ---------- Create panes & charts ----------
    const charts = {}; // regionId -> chart instance

    REGIONS.forEach((r,i)=>{
      const pane = document.createElement('section');
      pane.id = r.id;
      pane.className = 'tab-pane ' + (i===0?'':'hidden');
      pane.setAttribute('role','tabpanel');
      pane.innerHTML = `
        <div class="mb-8">
          <div class="flex items-center justify-between flex-wrap gap-4">
            <h2 class="text-2xl md:text-3xl font-bold" style="color:${r.color}">${r.label}</h2>
            <span class="chip" style="background:${r.bg}; color:#0f172a">Avg. barrier mix — filters apply</span>
          </div>
          <div class="mt-4 bg-white border border-slate-200 rounded-xl p-4">
            <canvas id="chart-${r.id}" height="80" aria-label="Barrier chart for ${r.label}" role="img"></canvas>
          </div>
        </div>
        <div class="grid md:grid-cols-2 xl:grid-cols-3 gap-6" id="grid-${r.id}"></div>
      `;
      panesEl.appendChild(pane);

      const ctx = pane.querySelector(`#chart-${r.id}`).getContext('2d');
      const items = visibleItems(r.id);
      const mix = aggregateMix(items);
      charts[r.id] = new Chart(ctx, {
        type:'bar',
        data:{
          labels:['Logistics','Regulatory','Culture/Trust','Language'],
          datasets:[{
            label:'Barrier %',
            data:[mix.logistics, mix.regulatory, mix.culture, mix.language],
            backgroundColor:[r.color+'33', r.color+'33', r.color+'33', r.color+'33'],
            borderColor:[r.color, r.color, r.color, r.color],
            borderWidth:1.5
          }]
        },
        options:{
          plugins:{ legend:{ display:false }, tooltip:{ enabled:true } },
          scales:{ y:{ beginAtZero:true, max:100, ticks:{ stepSize:20 } } }
        }
      });
    });

    // ---------- Render all (cards + charts) ----------
    function renderAll(){
      REGIONS.forEach(r => {
        const grid = document.getElementById(`grid-${r.id}`);
        grid.innerHTML = '';
        const items = visibleItems(r.id);
        const mix = aggregateMix(items);
        const chart = charts[r.id];
        if(chart){
          chart.data.datasets[0].data = [mix.logistics, mix.regulatory, mix.culture, mix.language];
          chart.update();
        }
        if(items.length === 0){
          const empty = document.createElement('div');
          empty.className = 'text-sm text-slate-500 italic';
          empty.textContent = 'No countries match the selected biomarker filters in this region.';
          grid.appendChild(empty);
        } else {
          items.forEach(d=>{
            const card = document.createElement('article');
            card.className = 'card p-5';
            const tags = (d.biomarkers||[]).map(b=>`<span class="chip" title="Biomarker">${b}</span>`).join(' ');
            card.innerHTML = `
              <div class="flex items-start justify-between gap-4">
                <h3 class="text-xl font-bold text-slate-800">${d.name}</h3>
                <span class="chip" style="background:${r.bg}">${d.regulator}</span>
              </div>
              <div class="mt-3 text-sm text-slate-600">
                <div class="mb-2"><strong class="text-slate-800">Ethics Path:</strong> ${d.ethics}</div>
                <div class="mb-2"><strong class="text-slate-800">Key Orgs:</strong> ${d.orgs.join(', ')}</div>
                <div class="mb-2"><strong class="text-slate-800">Nuances:</strong> ${d.nuances}</div>
                <div class="mt-3 p-3 rounded-lg" style="background:${r.bg}">
                  <span class="block text-xs uppercase tracking-wide text-slate-500 mb-1">Insight</span>
                  <p class="text-slate-800">${d.interview}</p>
                </div>
                <div class="mt-3 flex flex-wrap gap-2">${tags}</div>
              </div>
            `;
            grid.appendChild(card);
          });
        }
      });
    }

    renderAll();

    // ---------- Tab logic ----------
    tabsEl.addEventListener('click', (e)=>{
      if(e.target.tagName !== 'BUTTON') return;
      const targetId = e.target.dataset.tab;
      const activeRegion = REGIONS.find(r => r.id === targetId);
      if (!activeRegion) return;
      document.querySelectorAll('#tabs button').forEach(b => { b.style.backgroundColor=''; b.style.color=''; });
      e.target.style.backgroundColor = activeRegion.color;
      e.target.style.color = '#ffffff';
      document.querySelectorAll('.tab-pane').forEach(p => p.classList.add('hidden'));
      document.getElementById(targetId).classList.remove('hidden');
    });
  </script>
</body>
</html>
