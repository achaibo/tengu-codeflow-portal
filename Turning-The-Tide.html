'use client';

import React, { useEffect } from 'react';
import {
  ResponsiveContainer,
  BarChart,
  Bar,
  LineChart,
  Line,
  XAxis,
  YAxis,
  CartesianGrid,
  Tooltip,
  Legend,
  RadarChart,
  PolarGrid,
  PolarAngleAxis,
  PolarRadiusAxis,
  Radar,
  ScatterChart,
  Scatter,
  ZAxis,
} from 'recharts';

// NOTE: Using emoji icons to avoid extra icon deps in sandbox. Swap to 'lucide-react' if desired.

// ---------------- Data ----------------
const activationData = [
  { region: 'EU (Before)', days: 100 },
  { region: 'EU (After)', days: 70 }, // ~30% faster
];

const enrollmentData = [
  { month: 'M-3', NA: 60 },
  { month: 'M-2', NA: 62 },
  { month: 'M-1', NA: 65 },
  { month: 'M0', NA: 68 },
  { month: 'M+1', NA: 75 },
  { month: 'M+2', NA: 88 }, // ~35% surge
];

const qualityRadar = [
  { metric: 'Trip Report QA', before: 55, after: 88 },
  { metric: 'TMF Health', before: 60, after: 90 },
  { metric: 'Query Aging', before: 50, after: 82 },
  { metric: 'PD Detection', before: 48, after: 85 },
  { metric: 'Inspection Readiness', before: 58, after: 93 },
];

const sampleDelayBubbles = [
  { label: 'Pre-bootcamp', week: 0, delay: 18, labs: 2 },
  { label: 'Post-bootcamp', week: 8, delay: 10, labs: 4 },
  { label: 'Tracker 2.0', week: 12, delay: 9, labs: 6 },
  { label: 'Steady-state', week: 20, delay: 7, labs: 8 }, // ~45% reduction
];

// --------------- Sanity Tests (non-blocking) ---------------
function runSanityTests() {
  const messages: string[] = [];
  let passed = true;

  // Test 1: activationData should have 2 entries and decreasing days
  if (!Array.isArray(activationData) || activationData.length !== 2) {
    passed = false;
    messages.push('activationData should contain exactly 2 points');
  } else if (!(activationData[0].days > activationData[1].days)) {
    passed = false;
    messages.push('activationData should show improvement (before > after)');
  }

  // Test 2: enrollmentData non-empty
  if (!Array.isArray(enrollmentData) || enrollmentData.length === 0) {
    passed = false;
    messages.push('enrollmentData should not be empty');
  }

  // Test 3: qualityRadar items have before & after numbers
  for (const q of qualityRadar) {
    if (typeof q.before !== 'number' || typeof q.after !== 'number') {
      passed = false;
      messages.push('qualityRadar entries must have numeric before/after');
      break;
    }
  }

  // Test 4: sampleDelayBubbles shows reduced delays over time
  if (!(sampleDelayBubbles[0].delay >= sampleDelayBubbles[sampleDelayBubbles.length - 1].delay)) {
    passed = false;
    messages.push('sample delays should drop by the last point');
  }

  // Test 5 (added): No NaN values in numeric arrays
  const isNum = (n: unknown) => typeof n === 'number' && !Number.isNaN(n);
  if (!activationData.every(d => isNum(d.days))) {
    passed = false;
    messages.push('activationData contains non-numeric values');
  }
  if (!enrollmentData.every(d => isNum(d.NA))) {
    passed = false;
    messages.push('enrollmentData contains non-numeric values');
  }

  // eslint-disable-next-line no-console
  (passed ? console.log : console.warn)(
    '[SanityTests]',
    passed ? 'All tests passed ‚úÖ' : messages
  );

  return { passed, messages };
}

const Pill: React.FC<{ children: React.ReactNode }> = ({ children }) => (
  <span className="inline-flex items-center gap-2 rounded-full border border-white/20 bg-white/10 px-3 py-1 text-xs text-white backdrop-blur">
    {children}
  </span>
);

const Stat: React.FC<{ label: string; value: string; sub?: string; icon: string }> = ({ label, value, sub, icon }) => (
  <div className="rounded-2xl bg-white/80 p-4 shadow-sm ring-1 ring-black/5">
    <div className="flex items-center gap-3">
      <div className="rounded-xl bg-gradient-to-br from-indigo-500 to-fuchsia-500 p-2 text-white">
        <span className="text-lg">{icon}</span>
      </div>
      <div>
        <div className="text-sm text-slate-500">{label}</div>
        <div className="text-2xl font-semibold text-slate-900">{value}</div>
        {sub && <div className="text-xs text-slate-500">{sub}</div>}
      </div>
    </div>
  </div>
);

export default function AbderaCaseStudySite(): JSX.Element {
  const { passed, messages } = runSanityTests();
  useEffect(() => {
    // Tests already log to console; effect keeps lints happy in strict mode
  }, [passed, messages]);

  return (
    <div className="relative min-h-screen w-full overflow-x-hidden bg-gradient-to-b from-slate-900 via-indigo-950 to-slate-950 text-slate-100">
      {/* Decorative bubbles */}
      <div className="pointer-events-none absolute -top-24 -left-24 h-96 w-96 rounded-full bg-gradient-to-br from-fuchsia-500/30 to-cyan-400/20 blur-3xl" />
      <div className="pointer-events-none absolute top-40 -right-24 h-96 w-96 rounded-full bg-gradient-to-br from-indigo-500/30 to-emerald-400/20 blur-3xl" />
      <div className="pointer-events-none absolute bottom-10 left-1/3 h-72 w-72 rounded-full bg-gradient-to-br from-cyan-500/20 to-fuchsia-400/20 blur-3xl" />

      {/* Header */}
      <header className="mx-auto max-w-6xl px-6 pt-12">
        <div className="flex flex-wrap items-center justify-between gap-4">
          <div>
            <h1 className="text-3xl font-extrabold tracking-tight text-white md:text-5xl">
              Case Study: Turning a Stalled Global Oncology Trial into a High-Velocity, Inspection-Ready Success
            </h1>
            <p className="mt-3 text-sm md:text-base text-slate-300">
              By <span className="font-semibold">Tengu Muna</span>
            </p>
          </div>
          <div className="flex flex-wrap items-center gap-2">
            <Pill>üåç 200+ sites ¬∑ NA ¬∑ LATAM ¬∑ EU ¬∑ APAC</Pill>
            <Pill>üß™ NSCLC & Gastric ¬∑ CDx ¬∑ IVDR</Pill>
            <Pill>üõ°Ô∏è FDA ¬∑ MHRA ¬∑ PMDA</Pill>
          </div>
        </div>

        {/* CTA row */}
        <div className="mt-6 flex flex-wrap items-center gap-3">
          <a
            href="https://www.notion.so/Abdera-Therapeutics-Application-Sr-Manager-Manager-Clinical-Site-Management-Contract-Remote-25c9315af4bf807391c4c7df5aea7901?source=copy_link"
            target="_blank"
            rel="noreferrer"
            className="group inline-flex items-center gap-2 rounded-xl bg-white/10 px-4 py-2 text-sm font-medium text-white ring-1 ring-white/20 transition hover:bg-white/20"
          >
            View Portfolio & Case Study in Notion <span className="transition group-hover:translate-x-0.5">‚Üó</span>
          </a>
        </div>
      </header>

      {/* Executive Snapshot */}
      <section className="mx-auto mt-10 max-w-6xl px-6">
        <div className="rounded-3xl bg-white/10 p-6 ring-1 ring-white/10 backdrop-blur">
          <h2 className="text-xl font-semibold text-white md:text-2xl">Executive Snapshot</h2>
          <p className="mt-2 max-w-3xl text-slate-300">
            Scope: Global oversight of a pivotal NSCLC & Gastric Cancer program across 200+ sites in North America, LATAM, and Europe (EUCTR & non-EUCTR), with APAC monitoring oversight. Biomarker-driven enrollment with a Companion Diagnostic (CDx) under IVDR. Facing EU regulatory bottlenecks, a North American enrollment slump, and inconsistent global monitoring, the program was at risk of missing a fast-approaching futility analysis.
          </p>

          <div className="mt-6 grid grid-cols-2 gap-4 md:grid-cols-4">
            <Stat icon="üöÄ" label="EU Activation" value="30% faster" sub="War-room + dual-track EUCTR playbooks" />
            <Stat icon="üë•" label="NA Enrollment" value="+35%" sub="Advocacy roadshows + DAPs" />
            <Stat icon="üß´" label="CDx Delays" value="-45%" sub="Lab bootcamps + Tracker 2.0" />
            <Stat icon="üõ°Ô∏è" label="Inspections" value="0 major" sub="FDA ¬∑ MHRA ¬∑ PMDA" />
          </div>
        </div>
      </section>

      {/* Charts Row */}
      <section className="mx-auto mt-10 max-w-6xl px-6">
        <div className="grid grid-cols-1 gap-6 md:grid-cols-2">
          <div className="rounded-3xl bg-white p-5 text-slate-900 shadow-lg ring-1 ring-black/5">
            <h3 className="mb-3 text-lg font-semibold">EU Site Activation (Days to FPI)</h3>
            <ResponsiveContainer width="100%" height={260}>
              <BarChart data={activationData}>
                <CartesianGrid strokeDasharray="3 3" />
                <XAxis dataKey="region" />
                <YAxis />
                <Tooltip />
                <Legend />
                <Bar dataKey="days" name="Days" radius={[8, 8, 0, 0]} />
              </BarChart>
            </ResponsiveContainer>
            <p className="mt-2 text-sm text-slate-600">Dual-track EUCTR vs non-EUCTR + country playbooks drove meaningful acceleration.</p>
          </div>

          <div className="rounded-3xl bg-white p-5 text-slate-900 shadow-lg ring-1 ring-black/5">
            <h3 className="mb-3 text-lg font-semibold">North America Enrollment Trend</h3>
            <ResponsiveContainer width="100%" height={260}>
              <LineChart data={enrollmentData}>
                <CartesianGrid strokeDasharray="3 3" />
                <XAxis dataKey="month" />
                <YAxis />
                <Tooltip />
                <Legend />
                <Line type="monotone" dataKey="NA" name="Accrual" strokeWidth={3} dot />
              </LineChart>
            </ResponsiveContainer>
            <p className="mt-2 text-sm text-slate-600">Advocacy roadshows + site-specific blueprints reversed the slump and diversified accrual.</p>
          </div>
        </div>
      </section>

      {/* Radar + Bubble */}
      <section className="mx-auto mt-6 max-w-6xl px-6">
        <div className="grid grid-cols-1 gap-6 md:grid-cols-2">
          <div className="rounded-3xl bg-white p-5 text-slate-900 shadow-lg ring-1 ring-black/5">
            <h3 className="mb-3 text-lg font-semibold">Quality & Readiness Uplift</h3>
            <ResponsiveContainer width="100%" height={300}>
              <RadarChart cx="50%" cy="50%" outerRadius="80%" data={qualityRadar}>
                <PolarGrid />
                <PolarAngleAxis dataKey="metric" />
                <PolarRadiusAxis />
                <Radar name="Before" dataKey="before" stroke="#94a3b8" fill="#94a3b8" fillOpacity={0.4} />
                <Radar name="After" dataKey="after" stroke="#6366f1" fill="#6366f1" fillOpacity={0.6} />
                <Legend />
                <Tooltip />
              </RadarChart>
            </ResponsiveContainer>
          </div>

          <div className="rounded-3xl bg-white p-5 text-slate-900 shadow-lg ring-1 ring-black/5">
            <h3 className="mb-3 text-lg font-semibold">CDx Sample Delay vs Lab Enablement (Bubble)</h3>
            <ResponsiveContainer width="100%" height={300}>
              <ScatterChart>
                <CartesianGrid />
                <XAxis type="number" dataKey="week" name="Week" />
                <YAxis type="number" dataKey="delay" name="Avg Delay (days)" />
                <ZAxis type="number" dataKey="labs" name="# Labs Enabled" range={[80, 400]} />
                <Tooltip cursor={{ strokeDasharray: '3 3' }} />
                <Legend />
                <Scatter name="EU Labs" data={sampleDelayBubbles} />
              </ScatterChart>
            </ResponsiveContainer>
            <p className="mt-2 text-sm text-slate-600">Bootcamps + Tracker 2.0 increased enabled labs while shrinking delay days.</p>
          </div>
        </div>
      </section>

      {/* Strategy Sections */}
      <section className="mx-auto mt-10 max-w-6xl space-y-6 px-6">
        <div className="grid grid-cols-1 gap-6 md:grid-cols-2">
          <div className="rounded-3xl border border-white/10 bg-white/5 p-6">
            <h3 className="text-lg font-semibold text-white">Europe: Precision Mapping & War-Room Activation</h3>
            <ul className="mt-3 list-disc space-y-2 pl-5 text-slate-200">
              <li>Weekly sponsor‚ÄìCRO war-room; EUCTR vs non-EUCTR dual-track playbooks.</li>
              <li>Country heat-map: ethics, contracts, IVDR readiness, lab capacity.</li>
              <li>France IVDR taskforce with daily EC/CDx stand-ups; compliant fast-lane SOPs.</li>
            </ul>
          </div>
          <div className="rounded-3xl border border-white/10 bg-white/5 p-6">
            <h3 className="text-lg font-semibold text-white">North America: Hyper-Local Recruitment Engine</h3>
            <ul className="mt-3 list-disc space-y-2 pl-5 text-slate-200">
              <li>Site-specific one-pagers: catchment, referrals, screen-fail patterns, owners.</li>
              <li>Advocacy roadshows + Diversity Action Plans; bilingual materials and micro-support.</li>
              <li>Decisive open/close calls; rapid SSU pods for high-potential replacements.</li>
            </ul>
          </div>
          <div className="rounded-3xl border border-white/10 bg-white/5 p-6">
            <h3 className="text-lg font-semibold text-white">LATAM & APAC: Stabilize & Standardize</h3>
            <ul className="mt-3 list-disc space-y-2 pl-5 text-slate-200">
              <li>LATAM contracting accelerators; PI champion network and KPI nudges.</li>
              <li>APAC trip-report QA rubric; 48-hour turnaround with CRA coaching notes.</li>
              <li>Spot co-monitoring; harmonized narratives to separate signals from noise.</li>
            </ul>
          </div>
          <div className="rounded-3xl border border-white/10 bg-white/5 p-6">
            <h3 className="text-lg font-semibold text-white">CDx & IVDR: From Bottleneck to Flow</h3>
            <ul className="mt-3 list-disc space-y-2 pl-5 text-slate-200">
              <li>Cross-screening matrix across sister protocols to protect accrual.</li>
              <li>EU lab bootcamps on IVDR documentation, chain-of-custody, turnaround.</li>
              <li>Sample-Tracker 2.0 with SLA timers and auto-escalations.</li>
            </ul>
          </div>
        </div>

        <div className="rounded-3xl border border-white/10 bg-white/5 p-6">
          <h3 className="text-lg font-semibold text-white">Data Integrity, Futility Readiness & Inspections</h3>
          <div className="mt-3 grid grid-cols-1 gap-6 md:grid-cols-3">
            <div>
              <h4 className="font-medium text-indigo-300">Data & Futility</h4>
              <ul className="mt-2 list-disc space-y-2 pl-5 text-slate-200">
                <li>Weekly global data sprints with DM/Stats/Medical; real-time query triage.</li>
                <li>Real-time accrual and aging dashboards; high-touch coaching for top-risk sites.</li>
                <li>Critical discrepancies reduced by ~40% ahead of futility lock.</li>
              </ul>
            </div>
            <div>
              <h4 className="font-medium text-indigo-300">Inspection Excellence</h4>
              <ul className="mt-2 list-disc space-y-2 pl-5 text-slate-200">
                <li>Monthly mock audits; TMF/ISF health checks; evidence of effectiveness.</li>
                <li>FDA, MHRA, PMDA inspections: <span className="font-semibold">zero major findings</span>.</li>
                <li>SOP refresh to reflect EUCTR/IVDR nuances and AI-assisted reviews.</li>
              </ul>
            </div>
            <div>
              <h4 className="font-medium text-indigo-300">CAPA Governance</h4>
              <ul className="mt-2 list-disc space-y-2 pl-5 text-slate-200">
                <li>Root-cause discipline (5-Whys, fishbone) and RACI ownership.</li>
                <li>Central tracker with SLAs; aging watchlist; documented closures in TMF.</li>
                <li>Preventive changes embedded into site playbooks and CRA retraining.</li>
              </ul>
            </div>
          </div>
        </div>
      </section>

      {/* Closing */}
      <section className="mx-auto mt-10 max-w-6xl px-6 pb-20">
        <div className="rounded-3xl bg-gradient-to-br from-indigo-600/30 to-fuchsia-600/30 p-8 ring-1 ring-white/10">
          <h3 className="text-2xl font-semibold text-white">Conclusion: Why This Matters</h3>
          <p className="mt-3 text-slate-100/90">
            Global programs succeed when sites are empowered, CRAs are equipped, and oversight is hands-on. By blending regulatory strategy (EUCTR/IVDR), site-centered execution, and technology-enabled monitoring, we turned a high-risk program into a high-velocity, inspection-ready engine‚Äîwithout compromising patient safety or data integrity.
          </p>
          <div className="mt-6 flex justify-center">
            <a
              href="https://www.linkedin.com/in/tengumuna/"
              target="_blank"
              rel="noreferrer"
              className="inline-flex items-center gap-2 rounded-xl bg-white/10 px-4 py-2 text-sm font-medium text-white ring-1 ring-white/20 transition hover:bg-white/20"
            >
              Connect on LinkedIn <span>‚Üó</span>
            </a>
          </div>
        </div>
        <p className="mt-6 text-center text-xs text-slate-400">¬© {new Date().getFullYear()} Tengu Muna ¬∑ Site-centric, tech-enabled clinical operations leadership</p>

        {/* Visually hidden test status */}
        <div className="sr-only" aria-live="polite">
          {passed ? 'Sanity tests passed' : `Sanity test issues: ${messages.join('; ')}`}
        </div>
      </section>
    </div>
  );
}

